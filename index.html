<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Analisis Butir Soal & Nilai Siswa</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Sembunyikan tab content secara default */
        .tab-content {
            display: none;
        }
        /* Tampilkan tab yang aktif */
        .tab-content.active {
            display: block;
        }
        /* Style untuk tombol tab aktif */
        .tab-button.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        
        /* Pengaturan Cetak */
        @media print {
            body {
                font-family: sans-serif;
            }
            /* Sembunyikan semua elemen yang tidak perlu */
            #input-section, #header-section, #tab-buttons, #action-buttons, #info-box,
            .no-print, .navigation-menu {
                display: none !important;
            }
            /* Tampilkan header khusus untuk print */
            .print-header {
                display: flex !important;
                align-items: center;
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 2px solid #000;
            }
            /* Pastikan semua tab content terlihat saat print */
            .tab-content {
                display: block !important;
                margin-bottom: 2rem;
                box-shadow: none;
                border: none;
            }
            /* Tampilkan identitas ujian saat print */
            .print-identitas {
                display: block !important;
                margin-bottom: 1rem;
                padding: 1rem;
                background: #f8f9fa;
                border: 1px solid #dee2e6;
            }
            /* Tampilkan approval saat print */
            .print-approval {
                display: flex !important;
                justify-content: space-between;
                margin-top: 3rem;
                page-break-before: always;
            }
            /* Tampilkan soal saat print */
            .print-soal {
                display: block !important;
                page-break-before: always;
            }
            /* Tampilkan tabel input untuk print */
            .print-tabel-input {
                display: block !important;
                page-break-before: always;
            }
        }

        /* Sembunyikan elemen print secara default */
        .print-header, .print-identitas, .print-approval, .print-soal, .print-tabel-input {
            display: none;
        }

        /* Style untuk input */
        .jawaban-input {
            width: 35px;
            height: 35px;
            text-align: center;
            text-transform: uppercase;
            font-size: 12px;
        }

        .input-kecil {
            font-size: 12px;
            padding: 4px 6px;
            height: 35px;
        }

        /* Style untuk logo */
        .logo {
            height: 80px;
            width: auto;
        }
        .print-logo {
            height: 70px;
            width: auto;
        }

        /* Style untuk kartu soal */
        .soal-card {
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        .soal-card.sulit {
            border-left-color: #ef4444;
            background-color: #fef2f2;
        }
        .soal-card.sedang {
            border-left-color: #f59e0b;
            background-color: #fffbeb;
        }
        .soal-card.mudah {
            border-left-color: #10b981;
            background-color: #f0fdf4;
        }

        /* Badge kategori */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-sulit {
            background-color: #fecaca;
            color: #dc2626;
        }
        .badge-sedang {
            background-color: #fed7aa;
            color: #ea580c;
        }
        .badge-mudah {
            background-color: #bbf7d0;
            color: #16a34a;
        }

        /* Style untuk identitas ujian */
        .identitas-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Style untuk tanda tangan */
        .ttd-area {
            margin-top: 60px;
            text-align: center;
        }
        .ttd-line {
            border-bottom: 1px solid #000;
            width: 180px;
            margin: 0 auto;
            padding-top: 40px;
        }

        /* Style untuk tabel input yang compact */
        .table-input-compact {
            font-size: 11px;
        }
        .table-input-compact th {
            padding: 6px 3px;
            font-weight: 600;
        }
        .table-input-compact td {
            padding: 4px 2px;
        }

        /* Style untuk section */
        .section-card {
            transition: all 0.3s ease;
        }

        /* Style untuk textarea soal */
        .soal-textarea {
            min-height: 80px;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Style untuk input tabel */
        .table-input {
            width: 30px;
            height: 30px;
            text-align: center;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
            text-transform: uppercase;
        }

        /* Style untuk hidden */
        .hidden {
            display: none;
        }
    </style>
    <!-- Memuat font Inter dari Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        
        <!-- Header Print -->
        <div class="print-header">
            <div class="flex items-center space-x-4">
                <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                     alt="Logo SMK Negeri 1 Purbalingga" class="print-logo">
                <div>
                    <h1 class="text-xl font-bold">SMK NEGERI 1 PURBALINGGA</h1>
                    <p class="text-sm">LAPORAN ANALISIS BUTIR SOAL & NILAI SISWA</p>
                    <p class="text-xs text-gray-600">Jl. Letjend. Suprapto No. 72 Purbalingga</p>
                </div>
            </div>
        </div>

        <!-- Identitas Ujian untuk Print -->
        <div class="print-identitas">
            <table class="w-full">
                <tr>
                    <td class="font-bold">Mata Pelajaran</td>
                    <td>:</td>
                    <td id="print-mapel">-</td>
                    <td class="font-bold">Kelas</td>
                    <td>:</td>
                    <td id="print-kelas">-</td>
                </tr>
                <tr>
                    <td class="font-bold">Fase</td>
                    <td>:</td>
                    <td id="print-fase">-</td>
                    <td class="font-bold">Guru Mapel</td>
                    <td>:</td>
                    <td id="print-guru">-</td>
                </tr>
                <tr>
                    <td class="font-bold">Jenis Ujian</td>
                    <td>:</td>
                    <td id="print-jenis-ujian">-</td>
                    <td class="font-bold">Tanggal</td>
                    <td>:</td>
                    <td id="print-tanggal">-</td>
                </tr>
            </table>
        </div>

        <!-- Header -->
        <header id="header-section" class="mb-6 p-6 bg-white rounded-lg shadow-lg section-card">
            <div class="flex items-center space-x-4">
                <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                     alt="Logo SMK Negeri 1 Purbalingga" class="logo">
                <div>
                    <h1 class="text-3xl font-bold text-blue-800">Aplikasi Analisis Butir Soal & Nilai Siswa</h1>
                    <p class="text-gray-600 mt-2">SMK Negeri 1 Purbalingga - Menganalisis tingkat kesukaran soal dan status remedial siswa.</p>
                </div>
            </div>
        </header>

        <!-- Navigation Menu -->
        <div class="mb-6 bg-white rounded-lg shadow-lg p-4 section-card navigation-menu">
            <div class="flex flex-wrap gap-4 justify-center">
                <button id="nav-input-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                    üìù Input Data Ujian
                </button>
                <button id="nav-tabel-input-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold">
                    üìä Input Jawaban & Soal
                </button>
                <button id="nav-hasil-btn" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition font-semibold">
                    üìà Hasil Analisis
                </button>
            </div>
        </div>

        <!-- Section 1: Input Data Ujian -->
        <section id="input-section" class="mb-6 p-6 bg-white rounded-lg shadow-lg section-card">
            <!-- Identitas Ujian -->
            <div class="mb-6 p-6 identitas-card rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-white mb-4">Identitas Ujian</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label for="namaMapel" class="block text-sm font-medium text-white mb-2">Nama Mata Pelajaran:</label>
                        <input type="text" id="namaMapel" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil" placeholder="Contoh: Matematika">
                    </div>
                    <div>
                        <label for="kelas" class="block text-sm font-medium text-white mb-2">Kelas:</label>
                        <input type="text" id="kelas" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil" placeholder="Contoh: X TKJ 1">
                    </div>
                    <div>
                        <label for="fase" class="block text-sm font-medium text-white mb-2">Fase:</label>
                        <select id="fase" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                            <option value="">Pilih Fase</option>
                            <option value="Fase A">Fase A (Kelas 1-2)</option>
                            <option value="Fase B">Fase B (Kelas 3-4)</option>
                            <option value="Fase C">Fase C (Kelas 5-6)</option>
                            <option value="Fase D">Fase D (Kelas 7-9)</option>
                            <option value="Fase E">Fase E (Kelas 10)</option>
                            <option value="Fase F">Fase F (Kelas 11-12)</option>
                        </select>
                    </div>
                    <div>
                        <label for="guruMapel" class="block text-sm font-medium text-white mb-2">Guru Mata Pelajaran:</label>
                        <select id="guruMapel" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                            <option value="">Pilih Guru</option>
                        </select>
                        <input type="hidden" id="nipGuru">
                    </div>
                </div>
                
                <div class="mt-4 grid grid-cols-1 gap-4">
                    <div>
                        <label for="tujuanPembelajaran" class="block text-sm font-medium text-white mb-2">Tujuan Pembelajaran:</label>
                        <textarea id="tujuanPembelajaran" rows="2" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil" placeholder="Tuliskan tujuan pembelajaran yang diujikan..."></textarea>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label for="jenisUjian" class="block text-sm font-medium text-white mb-2">Jenis Ujian:</label>
                        <select id="jenisUjian" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                            <option value="Ulangan Harian">Ulangan Harian</option>
                            <option value="UTS">UTS</option>
                            <option value="UAS">UAS</option>
                            <option value="UKK">UKK</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label for="tanggalUjian" class="block text-sm font-medium text-white mb-2">Tanggal Ujian:</label>
                        <input type="date" id="tanggalUjian" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Kolom Input Pengaturan -->
                <div class="md:col-span-1">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">1. Pengaturan Ujian</h2>
                    <div class="mb-4">
                        <label for="kkm" class="block text-sm font-medium text-gray-700 mb-2">Tentukan KKM (Skala 1-10):</label>
                        <input type="number" id="kkm" value="7.5" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                    </div>
                    <div class="mb-4">
                        <label for="jumlahSoal" class="block text-sm font-medium text-gray-700 mb-2">Jumlah Soal Pilihan Ganda:</label>
                        <input type="number" id="jumlahSoal" value="20" min="1" max="50" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                    </div>
                    <div class="mb-4">
                        <label for="jumlahSiswa" class="block text-sm font-medium text-gray-700 mb-2">Jumlah Siswa:</label>
                        <input type="number" id="jumlahSiswa" value="4" min="1" max="50" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil">
                    </div>
                    <div>
                        <label for="kunciJawaban" class="block text-sm font-medium text-gray-700 mb-2">Kunci Jawaban (pisahkan koma):</label>
                        <textarea id="kunciJawaban" rows="2" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm input-kecil" placeholder="Contoh: A,B,C,D,A,B,C,D,A,B,C,D,A,B,C,D,A,B,C,D"></textarea>
                    </div>
                    <div class="mt-4">
                        <button id="generateTableBtn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition duration-300 text-sm">
                            Buat Form Input
                        </button>
                    </div>
                </div>

                <!-- Kolom Input Data Siswa -->
                <div class="md:col-span-2">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">2. Input Data Jawaban Siswa</h2>
                    
                    <div id="tableInputInfo" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                            <p class="text-sm text-yellow-800">
                                <strong>Form input tersedia di lembar terpisah.</strong> Klik tombol "Buat Form Input" untuk membuat form, kemudian buka lembar "Input Jawaban & Soal" di menu navigasi atas.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tombol Proses -->
            <div class="mt-6 text-center">
                <button id="prosesButton" class="w-full md:w-auto bg-blue-600 text-white font-bold py-2 px-8 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 transform hover:scale-105 text-sm">
                    Proses Analisis Data
                </button>
            </div>
            
            <!-- Info Box untuk Error/Status -->
            <div id="info-box" class="mt-4 p-4 text-center rounded-lg hidden text-sm"></div>
        </section>

        <!-- Section 2: Input Jawaban & Soal -->
        <section id="tabel-input-section" class="mb-6 p-6 bg-white rounded-lg shadow-lg section-card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Input Jawaban & Soal</h2>
                <div class="flex gap-2">
                    <button id="printTabelBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm no-print">
                        üñ®Ô∏è Cetak Form Ini
                    </button>
                    <button id="kembaliDariTabelBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition text-sm no-print">
                        ‚Üê Kembali
                    </button>
                </div>
            </div>

            <!-- Info Identitas -->
            <div class="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div>
                        <span class="font-semibold text-blue-800">Mata Pelajaran:</span>
                        <span id="tabel-mapel">-</span>
                    </div>
                    <div>
                        <span class="font-semibold text-blue-800">Kelas:</span>
                        <span id="tabel-kelas">-</span>
                    </div>
                    <div>
                        <span class="font-semibold text-blue-800">Jumlah Soal:</span>
                        <span id="tabel-jumlah-soal">-</span>
                    </div>
                </div>
            </div>

            <!-- Tabel Input untuk Print -->
            <div class="print-tabel-input">
                <h3 class="text-lg font-bold mb-4">FORM INPUT JAWABAN SISWA</h3>
                <table class="min-w-full border border-gray-300 text-xs mb-8">
                    <thead>
                        <tr id="printTableHeader" class="bg-gray-100">
                            <!-- Header akan diisi oleh JavaScript -->
                        </tr>
                    </thead>
                    <tbody id="printTableBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>

                <!-- Soal untuk Print -->
                <div class="print-soal">
                    <h3 class="text-lg font-bold mb-4">DAFTAR SOAL</h3>
                    <div id="printSoalContainer">
                        <!-- Soal akan diisi oleh JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Tabel Input Interaktif -->
            <div class="no-print">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Tabel Input Jawaban Siswa</h3>
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200 table-input-compact">
                            <thead class="bg-gray-100">
                                <tr id="tableHeader">
                                    <!-- Header akan diisi oleh JavaScript -->
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">* Isi jawaban dengan A, B, C, D, E atau kosongkan jika tidak dijawab</p>
                </div>

                <!-- Input Soal -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Input Soal</h3>
                    <div id="soalContainer" class="space-y-4">
                        <!-- Soal akan diisi oleh JavaScript -->
                    </div>
                </div>
                
                <!-- Tips Navigasi -->
                <div class="mt-6 p-3 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-xs text-green-800">
                        <strong>Tips:</strong> Gunakan tombol panah (‚Üê ‚Üí ‚Üë ‚Üì) untuk navigasi cepat antar sel. Input akan otomatis kapital.
                    </p>
                </div>
            </div>
        </section>

        <!-- Section 3: Hasil Analisis -->
        <section id="hasil-section" class="mb-6 p-6 bg-white rounded-lg shadow-lg section-card hidden">
            <!-- Konten hasil analisis akan diisi oleh JavaScript -->
            <div class="text-center p-8 text-gray-500">
                <p>Belum ada data yang diproses.</p>
                <p class="text-sm">Klik "Proses Analisis Data" untuk melihat hasil analisis.</p>
            </div>
        </section>
    </div>

    <script>
        // --- DATA MASTER ---
        const defaultTeacherData = {
            "Maryono S.Pd, M.Si": "196607012000121002", 
            "Satyo Nugroho, S.Kom.": "197807142009031006",
            "Dra. Sri Mularsih": "196706201994122001", 
            "Budi Santoso, S.Pd": "197512032005011002",
            "Siti Aminah, M.Pd": "198203152008012003",
            "Ahmad Fauzi, S.Kom": "198511202012031004"
        };

        // Variabel global
        let analisisSoalData = [];
        let soalData = [];

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalUjian').value = today;
            populateTeacherDropdown();
            
            // Navigation Event Listeners
            document.getElementById('nav-input-btn').addEventListener('click', () => showSection('input-section'));
            document.getElementById('nav-tabel-input-btn').addEventListener('click', () => showSection('tabel-input-section'));
            document.getElementById('nav-hasil-btn').addEventListener('click', () => showSection('hasil-section'));
            
            document.getElementById('kembaliDariTabelBtn').addEventListener('click', () => showSection('input-section'));
            
            document.getElementById('printTabelBtn').addEventListener('click', printTabelInput);
            
            // Event Listeners lainnya
            document.getElementById('prosesButton').addEventListener('click', prosesAnalisisData);
            document.getElementById('generateTableBtn').addEventListener('click', generateInputTable);

            // Tampilkan section input secara default
            showSection('input-section');
        });

        // Fungsi untuk menampilkan section tertentu
        function showSection(sectionId) {
            // Sembunyikan semua section
            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('tabel-input-section').classList.add('hidden');
            document.getElementById('hasil-section').classList.add('hidden');
            
            // Tampilkan section yang dipilih
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update informasi di tabel input section
            if (sectionId === 'tabel-input-section') {
                updateTabelInfo();
            }
        }

        // Fungsi untuk mengisi dropdown guru
        function populateTeacherDropdown() {
            const guruSelect = document.getElementById('guruMapel');
            guruSelect.innerHTML = '<option value="">Pilih Guru</option>';
            
            Object.keys(defaultTeacherData).sort().forEach(guru => {
                const option = document.createElement('option');
                option.value = guru;
                option.textContent = guru;
                guruSelect.appendChild(option);
            });

            // Event listener untuk auto-fill NIP
            guruSelect.addEventListener('change', function() {
                const selectedGuru = this.value;
                const nip = defaultTeacherData[selectedGuru] || '-';
                document.getElementById('nipGuru').value = nip;
            });
        }

        // Fungsi untuk update informasi di tabel input section
        function updateTabelInfo() {
            document.getElementById('tabel-mapel').textContent = document.getElementById('namaMapel').value || '-';
            document.getElementById('tabel-kelas').textContent = document.getElementById('kelas').value || '-';
            document.getElementById('tabel-jumlah-soal').textContent = document.getElementById('jumlahSoal').value || '-';
        }

        // Fungsi untuk generate form input
        function generateInputTable() {
            const jumlahSoal = parseInt(document.getElementById('jumlahSoal').value);
            const jumlahSiswa = parseInt(document.getElementById('jumlahSiswa').value);
            
            if (jumlahSoal < 1 || jumlahSiswa < 1) {
                showInfo('Error: Jumlah soal dan jumlah siswa harus lebih dari 0.');
                return;
            }
            
            // Generate untuk tabel interaktif
            generateInteractiveTable(jumlahSoal, jumlahSiswa);
            
            // Generate untuk tabel print
            generatePrintTable(jumlahSoal, jumlahSiswa);
            
            // Generate input soal
            generateSoalInput(jumlahSoal);
            
            showInfo(`Form input berhasil dibuat untuk ${jumlahSiswa} siswa dan ${jumlahSoal} soal. Buka lembar "Input Jawaban & Soal" untuk mengisi data.`, 'success');
        }

        // Fungsi untuk generate tabel interaktif
        function generateInteractiveTable(jumlahSoal, jumlahSiswa) {
            const tableHeader = document.getElementById('tableHeader');
            let headerHTML = `
                <th class="px-2 py-1 text-left text-xs font-medium text-gray-600 uppercase w-12">No</th>
                <th class="px-2 py-1 text-left text-xs font-medium text-gray-600 uppercase w-20">NIS</th>
                <th class="px-2 py-1 text-left text-xs font-medium text-gray-600 uppercase w-32">Nama Siswa</th>
            `;
            
            for (let i = 1; i <= jumlahSoal; i++) {
                headerHTML += `<th class="px-1 py-1 text-xs font-medium text-gray-600 uppercase w-8">${i}</th>`;
            }
            
            tableHeader.innerHTML = headerHTML;
            
            const tableBody = document.getElementById('tableBody');
            let bodyHTML = '';
            
            for (let i = 0; i < jumlahSiswa; i++) {
                bodyHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-2 py-1 text-xs text-gray-900 text-center">${i + 1}</td>
                        <td class="px-2 py-1">
                            <input type="text" class="w-full p-1 border border-gray-300 rounded input-kecil nis-input" placeholder="NIS" value="${1001 + i}">
                        </td>
                        <td class="px-2 py-1">
                            <input type="text" class="w-full p-1 border border-gray-300 rounded input-kecil nama-input" placeholder="Nama" value="Siswa ${i + 1}">
                        </td>
                `;
                
                for (let j = 0; j < jumlahSoal; j++) {
                    bodyHTML += `
                        <td class="px-1 py-1">
                            <input type="text" class="w-full p-1 border border-gray-300 rounded table-input jawaban-input" maxlength="1" placeholder="" data-soal="${j + 1}">
                        </td>
                    `;
                }
                
                bodyHTML += `</tr>`;
            }
            
            tableBody.innerHTML = bodyHTML;
            setupTableNavigation();
        }

        // Fungsi untuk setup navigasi tabel
        function setupTableNavigation() {
            const inputs = document.querySelectorAll('.table-input');
            
            inputs.forEach(input => {
                // Auto uppercase
                input.addEventListener('input', function() {
                    this.value = this.value.toUpperCase();
                    updatePrintTable();
                    
                    // Auto focus ke input berikutnya
                    if (this.value.length === 1) {
                        const nextInput = this.closest('td').nextElementSibling?.querySelector('input');
                        if (nextInput) {
                            nextInput.focus();
                            nextInput.select();
                        }
                    }
                });

                // Navigasi dengan keyboard
                input.addEventListener('keydown', function(e) {
                    const currentCell = this.closest('td');
                    const currentRow = this.closest('tr');
                    const allRows = Array.from(document.querySelectorAll('#tableBody tr'));
                    const currentRowIndex = allRows.indexOf(currentRow);
                    const allCells = Array.from(currentRow.querySelectorAll('td'));
                    const currentCellIndex = allCells.indexOf(currentCell);
                    
                    switch(e.key) {
                        case 'ArrowRight':
                            e.preventDefault();
                            const nextCell = allCells[currentCellIndex + 1];
                            if (nextCell) {
                                const nextInput = nextCell.querySelector('input');
                                if (nextInput) {
                                    nextInput.focus();
                                    nextInput.select();
                                }
                            }
                            break;
                            
                        case 'ArrowLeft':
                            e.preventDefault();
                            const prevCell = allCells[currentCellIndex - 1];
                            if (prevCell) {
                                const prevInput = prevCell.querySelector('input');
                                if (prevInput) {
                                    prevInput.focus();
                                    prevInput.select();
                                }
                            }
                            break;
                            
                        case 'ArrowDown':
                            e.preventDefault();
                            const nextRow = allRows[currentRowIndex + 1];
                            if (nextRow) {
                                const nextRowCells = Array.from(nextRow.querySelectorAll('td'));
                                const nextInput = nextRowCells[currentCellIndex]?.querySelector('input');
                                if (nextInput) {
                                    nextInput.focus();
                                    nextInput.select();
                                }
                            }
                            break;
                            
                        case 'ArrowUp':
                            e.preventDefault();
                            const prevRow = allRows[currentRowIndex - 1];
                            if (prevRow) {
                                const prevRowCells = Array.from(prevRow.querySelectorAll('td'));
                                const prevInput = prevRowCells[currentCellIndex]?.querySelector('input');
                                if (prevInput) {
                                    prevInput.focus();
                                    prevInput.select();
                                }
                            }
                            break;
                    }
                });

                // Select all text when focused
                input.addEventListener('focus', function() {
                    this.select();
                });
            });
        }

        // Fungsi untuk generate input soal
        function generateSoalInput(jumlahSoal) {
            const soalContainer = document.getElementById('soalContainer');
            let soalHTML = '';
            
            for (let i = 1; i <= jumlahSoal; i++) {
                soalHTML += `
                    <div class="bg-white p-4 rounded-lg border border-gray-200">
                        <div class="flex items-start justify-between mb-3">
                            <h4 class="font-semibold text-gray-800">Soal Nomor ${i}</h4>
                            <span class="text-xs text-gray-500">Kunci: <span class="font-bold">${getKunciJawaban(i)}</span></span>
                        </div>
                        <textarea 
                            id="soal-${i}" 
                            class="w-full p-3 border border-gray-300 rounded-lg shadow-sm soal-textarea" 
                            placeholder="Tuliskan soal nomor ${i} di sini..."
                            oninput="updatePrintSoal(${i})"
                        ></textarea>
                    </div>
                `;
            }
            
            soalContainer.innerHTML = soalHTML;
            
            // Generate untuk print
            generatePrintSoal(jumlahSoal);
        }

        // Fungsi untuk mendapatkan kunci jawaban
        function getKunciJawaban(noSoal) {
            const kunciJawabanStr = document.getElementById('kunciJawaban').value.trim();
            if (!kunciJawabanStr) return '-';
            
            const kunci = kunciJawabanStr.split(',').map(k => k.trim().toUpperCase());
            return kunci[noSoal - 1] || '-';
        }

        // Fungsi untuk generate soal untuk print
        function generatePrintSoal(jumlahSoal) {
            const printSoalContainer = document.getElementById('printSoalContainer');
            let printSoalHTML = '';
            
            for (let i = 1; i <= jumlahSoal; i++) {
                printSoalHTML += `
                    <div class="mb-4 p-3 border-b border-gray-300">
                        <div class="flex justify-between items-start mb-2">
                            <strong>Soal Nomor ${i}</strong>
                            <span class="text-sm">Kunci: <strong>${getKunciJawaban(i)}</strong></span>
                        </div>
                        <div id="print-soal-${i}" class="text-sm whitespace-pre-wrap">
                            [Soal akan ditampilkan di sini]
                        </div>
                    </div>
                `;
            }
            
            printSoalContainer.innerHTML = printSoalHTML;
        }

        // Fungsi untuk update soal di print
        function updatePrintSoal(noSoal) {
            const soalText = document.getElementById(`soal-${noSoal}`).value;
            const printSoalElement = document.getElementById(`print-soal-${noSoal}`);
            if (printSoalElement) {
                printSoalElement.textContent = soalText || '[Soal akan ditampilkan di sini]';
            }
        }

        // Fungsi untuk generate tabel untuk print
        function generatePrintTable(jumlahSoal, jumlahSiswa) {
            const printHeader = document.getElementById('printTableHeader');
            let printHeaderHTML = `
                <th class="border border-gray-300 px-2 py-1 font-bold text-center">No</th>
                <th class="border border-gray-300 px-2 py-1 font-bold">NIS</th>
                <th class="border border-gray-300 px-2 py-1 font-bold">Nama Siswa</th>
            `;
            
            for (let i = 1; i <= jumlahSoal; i++) {
                printHeaderHTML += `<th class="border border-gray-300 px-1 py-1 font-bold text-center">${i}</th>`;
            }
            
            printHeader.innerHTML = printHeaderHTML;
            
            const printBody = document.getElementById('printTableBody');
            let printBodyHTML = '';
            
            for (let i = 0; i < jumlahSiswa; i++) {
                printBodyHTML += `
                    <tr>
                        <td class="border border-gray-300 px-2 py-1 text-center">${i + 1}</td>
                        <td class="border border-gray-300 px-2 py-1">${1001 + i}</td>
                        <td class="border border-gray-300 px-2 py-1">Siswa ${i + 1}</td>
                `;
                
                for (let j = 0; j < jumlahSoal; j++) {
                    printBodyHTML += `<td class="border border-gray-300 px-1 py-1 text-center"></td>`;
                }
                
                printBodyHTML += `</tr>`;
            }
            
            printBody.innerHTML = printBodyHTML;
        }

        // Fungsi untuk update tabel print berdasarkan input
        function updatePrintTable() {
            const rows = document.querySelectorAll('#tableBody tr');
            const printRows = document.querySelectorAll('#printTableBody tr');
            
            rows.forEach((row, rowIndex) => {
                const nis = row.querySelector('.nis-input').value;
                const nama = row.querySelector('.nama-input').value;
                const jawabanInputs = row.querySelectorAll('.jawaban-input');
                const printCells = printRows[rowIndex].querySelectorAll('td');
                
                // Update NIS dan Nama
                printCells[1].textContent = nis;
                printCells[2].textContent = nama;
                
                // Update jawaban
                jawabanInputs.forEach((input, cellIndex) => {
                    printCells[cellIndex + 3].textContent = input.value;
                });
            });
        }

        // Fungsi untuk print tabel input saja
        function printTabelInput() {
            const originalTitle = document.title;
            document.title = "Form Input Jawaban - " + (document.getElementById('namaMapel').value || 'Ujian');
            
            // Update tabel print terlebih dahulu
            updatePrintTable();
            
            // Simpan state elemen yang akan diubah
            const elementsToHide = document.querySelectorAll('.no-print');
            const originalDisplay = [];
            
            // Sembunyikan elemen yang tidak perlu
            elementsToHide.forEach(el => {
                originalDisplay.push(el.style.display);
                el.style.display = 'none';
            });
            
            // Tampilkan elemen print
            document.querySelector('.print-tabel-input').style.display = 'block';
            document.querySelector('.print-soal').style.display = 'block';
            
            // Print
            window.print();
            
            // Kembalikan state semula
            elementsToHide.forEach((el, index) => {
                el.style.display = originalDisplay[index];
            });
            document.querySelector('.print-tabel-input').style.display = 'none';
            document.querySelector('.print-soal').style.display = 'none';
            document.title = originalTitle;
        }

        // Fungsi untuk mengumpulkan data dari tabel input
        function collectDataFromTable() {
            const rows = document.querySelectorAll('#tableBody tr');
            const data = [];
            
            rows.forEach(row => {
                const nis = row.querySelector('.nis-input').value.trim();
                const nama = row.querySelector('.nama-input').value.trim();
                const jawabanInputs = row.querySelectorAll('.jawaban-input');
                const jawaban = Array.from(jawabanInputs).map(input => input.value.trim().toUpperCase() || '-');
                
                if (nis && nama) {
                    data.push([nis, nama, ...jawaban].join(','));
                }
            });
            
            return data.join('\n');
        }

        // Fungsi untuk validasi data
        function validateData(dataSiswaStr) {
            const kunciJawabanStr = document.getElementById('kunciJawaban').value.trim();
            const jumlahSoal = parseInt(document.getElementById('jumlahSoal').value);
            
            if (!kunciJawabanStr) {
                showInfo('Error: Kunci Jawaban tidak boleh kosong.');
                return false;
            }
            
            if (!dataSiswaStr) {
                showInfo('Error: Data siswa tidak boleh kosong.');
                return false;
            }
            
            const kunci = kunciJawabanStr.split(',').map(k => k.trim().toUpperCase());
            if (kunci.length !== jumlahSoal) {
                showInfo(`Error: Jumlah Kunci Jawaban (${kunci.length}) tidak sesuai dengan Jumlah Soal (${jumlahSoal}).`);
                return false;
            }
            
            const lines = dataSiswaStr.split('\n').filter(line => line.trim() !== "");
            if (lines.length === 0) {
                showInfo('Error: Tidak ada data siswa untuk diproses.');
                return false;
            }
            
            // Validasi setiap baris data siswa
            for (let i = 0; i < lines.length; i++) {
                const parts = lines[i].split(',');
                if (parts.length < (2 + jumlahSoal)) {
                    showInfo(`Error di baris ${i + 1}: Data tidak lengkap. Pastikan jumlah jawaban sesuai dengan jumlah soal.`);
                    return false;
                }
            }
            
            return true;
        }

        // Fungsi utama untuk proses analisis data
        function prosesAnalisisData() {
            // Update identitas ujian terlebih dahulu
            updateIdentitasUjian();
            
            // Kumpulkan data dari tabel input
            const dataSiswaStr = collectDataFromTable();
            
            // Validasi data
            if (!validateData(dataSiswaStr)) {
                return;
            }
            
            // Lakukan analisis
            const hasilAnalisis = lakukanAnalisis(dataSiswaStr);
            
            // Tampilkan hasil
            tampilkanHasilAnalisis(hasilAnalisis);
            
            showInfo(`Analisis berhasil diproses untuk ${hasilAnalisis.totalSiswa} siswa.`, 'success');
            showSection('hasil-section');
        }

        // Fungsi untuk melakukan analisis data
        function lakukanAnalisis(dataSiswaStr) {
            const kkm = parseFloat(document.getElementById('kkm').value);
            const jumlahSoal = parseInt(document.getElementById('jumlahSoal').value);
            const kunciJawabanStr = document.getElementById('kunciJawaban').value.trim();
            const kunci = kunciJawabanStr.split(',').map(k => k.trim().toUpperCase());
            const lines = dataSiswaStr.split('\n').filter(line => line.trim() !== "");
            
            // Inisialisasi analisis soal
            let analisisSoal = [];
            for (let i = 0; i < jumlahSoal; i++) {
                analisisSoal.push({ 
                    no: i + 1, 
                    kunci: kunci[i], 
                    benar: 0,
                    soalText: document.getElementById(`soal-${i + 1}`)?.value || `Soal nomor ${i + 1}`
                });
            }

            let analisisSiswa = [];
            const totalSiswa = lines.length;

            // Proses setiap siswa
            lines.forEach((line, index) => {
                const parts = line.split(',').map(p => p.trim());
                const nis = parts[0];
                const nama = parts[1];
                const jawabanSiswa = parts.slice(2, 2 + jumlahSoal);

                let jumlahBenar = 0;

                // Hitung jawaban benar per soal
                for (let i = 0; i < jumlahSoal; i++) {
                    let jawaban = jawabanSiswa[i] ? jawabanSiswa[i].toUpperCase() : "-";
                    if (jawaban.trim() === "") jawaban = "-";

                    if (jawaban === kunci[i]) {
                        jumlahBenar++;
                        analisisSoal[i].benar++;
                    }
                }

                // Hitung nilai siswa
                const nilaiAkhir = (jumlahBenar / jumlahSoal) * 10;
                const status = (nilaiAkhir >= kkm) ? 'Tuntas' : 'Remedial';

                analisisSiswa.push({ 
                    nis, 
                    nama, 
                    jumlahBenar, 
                    nilaiAkhir, 
                    status,
                    jawaban: jawabanSiswa
                });
            });

            // Hitung tingkat kesukaran (P) untuk setiap soal
            analisisSoal.forEach(soal => {
                soal.P = soal.benar / totalSiswa;
                
                // Tentukan kategori
                if (soal.P < 0.30) {
                    soal.kategori = 'Sulit';
                } else if (soal.P <= 0.70) {
                    soal.kategori = 'Sedang';
                } else {
                    soal.kategori = 'Mudah';
                }
            });

            return {
                analisisSoal,
                analisisSiswa,
                totalSiswa,
                jumlahSoal,
                kkm
            };
        }

        // Fungsi untuk menampilkan hasil analisis
        function tampilkanHasilAnalisis(hasil) {
            const hasilSection = document.getElementById('hasil-section');
            
            // Buat konten hasil analisis
            let hasilHTML = `
                <!-- Navigasi Tab -->
                <div id="tab-buttons" class="border-b border-gray-200 mb-4">
                    <nav class="flex -mb-px space-x-6 overflow-x-auto">
                        <button class="tab-button active py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap text-sm" onclick="showTab('analisisSoal')">
                            1. Analisis Butir Soal
                        </button>
                        <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap text-sm" onclick="showTab('analisisSiswa')">
                            2. Analisis Siswa
                        </button>
                        <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap text-sm" onclick="showTab('matriksJawaban')">
                            3. Matriks Jawaban
                        </button>
                        <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap text-sm" onclick="showTab('daftarSoal')">
                            4. Daftar Soal & Analisis
                        </button>
                    </nav>
                </div>

                <!-- Identitas Ujian di Hasil Analisis -->
                <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                        <div>
                            <span class="font-semibold text-blue-800">Mata Pelajaran:</span>
                            <span id="display-mapel" class="text-blue-900">${document.getElementById('namaMapel').value || '-'}</span>
                        </div>
                        <div>
                            <span class="font-semibold text-blue-800">Kelas:</span>
                            <span id="display-kelas" class="text-blue-900">${document.getElementById('kelas').value || '-'}</span>
                        </div>
                        <div>
                            <span class="font-semibold text-blue-800">Fase:</span>
                            <span id="display-fase" class="text-blue-900">${document.getElementById('fase').value || '-'}</span>
                        </div>
                        <div>
                            <span class="font-semibold text-blue-800">Guru Mapel:</span>
                            <span id="display-guru" class="text-blue-900">${document.getElementById('guruMapel').value || '-'}</span>
                        </div>
                    </div>
                    <div class="mt-2 text-sm">
                        <span class="font-semibold text-blue-800">Tujuan Pembelajaran:</span>
                        <span id="display-tp" class="text-blue-900">${document.getElementById('tujuanPembelajaran').value || '-'}</span>
                    </div>
                </div>

                <!-- Tombol Aksi Output -->
                <div id="action-buttons" class="flex flex-wrap gap-4 mb-4 no-print">
                    <button onclick="window.print()" class="bg-red-600 text-white py-2 px-5 rounded-lg shadow hover:bg-red-700 transition duration-300 text-sm">
                        Cetak Semua Laporan
                    </button>
                    <button onclick="showSection('input-section')" class="bg-gray-600 text-white py-2 px-5 rounded-lg shadow hover:bg-gray-700 transition duration-300 text-sm">
                        ‚Üê Kembali ke Input
                    </button>
                </div>

                <!-- Tab 1: Analisis Butir Soal -->
                <div id="analisisSoal" class="tab-content active">
                    ${generateAnalisisSoalHTML(hasil)}
                </div>

                <!-- Tab 2: Analisis Siswa -->
                <div id="analisisSiswa" class="tab-content">
                    ${generateAnalisisSiswaHTML(hasil)}
                </div>

                <!-- Tab 3: Matriks Jawaban -->
                <div id="matriksJawaban" class="tab-content">
                    ${generateMatriksJawabanHTML(hasil)}
                </div>

                <!-- Tab 4: Daftar Soal & Analisis -->
                <div id="daftarSoal" class="tab-content">
                    ${generateDaftarSoalHTML(hasil)}
                </div>
            `;
            
            hasilSection.innerHTML = hasilHTML;
        }

        // Fungsi untuk generate HTML analisis soal
        function generateAnalisisSoalHTML(hasil) {
            let html = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Hasil 1: Analisis Butir Soal (Tingkat Kesukaran)</h2>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                             alt="Logo SMK Negeri 1 Purbalingga" class="h-8 w-auto">
                        <span>SMK Negeri 1 Purbalingga</span>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-4">Kategori: Sulit (P &lt; 0.30), Sedang (0.30 &le; P &le; 0.70), Mudah (P &gt; 0.70).</p>
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">No. Soal</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Kunci</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Jml Benar</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Total Siswa</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Tingkat Kesukaran (P)</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Kategori</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            hasil.analisisSoal.forEach(soal => {
                const kategoriClass = soal.kategori === 'Sulit' ? 'text-red-700 font-bold' : 
                                   soal.kategori === 'Sedang' ? 'text-yellow-700 font-bold' : 'text-green-700 font-bold';
                
                html += `
                    <tr>
                        <td class="px-4 py-2 text-sm text-gray-900">${soal.no}</td>
                        <td class="px-4 py-2 text-sm text-gray-900 font-bold">${soal.kunci}</td>
                        <td class="px-4 py-2 text-sm text-gray-900">${soal.benar}</td>
                        <td class="px-4 py-2 text-sm text-gray-900">${hasil.totalSiswa}</td>
                        <td class="px-4 py-2 text-sm text-gray-900">${soal.P.toFixed(2)}</td>
                        <td class="px-4 py-2 text-sm ${kategoriClass}">${soal.kategori}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return html;
        }

        // Fungsi untuk generate HTML analisis siswa
        function generateAnalisisSiswaHTML(hasil) {
            let html = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Hasil 2: Analisis Siswa (Status Remedial)</h2>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                             alt="Logo SMK Negeri 1 Purbalingga" class="h-8 w-auto">
                        <span>SMK Negeri 1 Purbalingga</span>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">NIS</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Nama Siswa</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Jml Benar</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Nilai</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase">Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Urutkan siswa: remedial dulu
            hasil.analisisSiswa.sort((a, b) => a.status === 'Remedial' ? -1 : 1);
            
            hasil.analisisSiswa.forEach(siswa => {
                const statusClass = siswa.status === 'Remedial' ? 'text-red-700 font-bold bg-red-50' : 'text-green-700';
                const rowClass = siswa.status === 'Remedial' ? 'bg-red-50' : '';
                
                html += `
                    <tr class="${rowClass}">
                        <td class="px-4 py-2 text-sm text-gray-900">${siswa.nis}</td>
                        <td class="px-4 py-2 text-sm text-gray-900">${siswa.nama}</td>
                        <td class="px-4 py-2 text-sm text-gray-900">${siswa.jumlahBenar} / ${hasil.jumlahSoal}</td>
                        <td class="px-4 py-2 text-sm text-gray-900 font-bold">${siswa.nilaiAkhir.toFixed(1)}</td>
                        <td class="px-4 py-2 text-sm ${statusClass}">${siswa.status}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return html;
        }

        // Fungsi untuk update identitas ujian
        function updateIdentitasUjian() {
            const namaMapel = document.getElementById('namaMapel').value || '-';
            const kelas = document.getElementById('kelas').value || '-';
            const fase = document.getElementById('fase').value || '-';
            const guruMapel = document.getElementById('guruMapel').value || '-';
            const nipGuru = document.getElementById('nipGuru').value || '-';
            const tujuanPembelajaran = document.getElementById('tujuanPembelajaran').value || '-';
            const jenisUjian = document.getElementById('jenisUjian').value || '-';
            const tanggalUjian = document.getElementById('tanggalUjian').value || '-';
            
            // Format tanggal untuk display
            const tanggalDisplay = tanggalUjian !== '-' ? 
                new Date(tanggalUjian).toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }) : '-';
            
            // Update untuk print
            document.getElementById('print-mapel').textContent = namaMapel;
            document.getElementById('print-kelas').textContent = kelas;
            document.getElementById('print-fase').textContent = fase;
            document.getElementById('print-guru').textContent = guruMapel;
            document.getElementById('print-jenis-ujian').textContent = jenisUjian;
            document.getElementById('print-tanggal').textContent = tanggalDisplay;
        }

        // Fungsi untuk menampilkan pesan info/error
        function showInfo(message, type = 'error') {
            const infoBox = document.getElementById('info-box');
            infoBox.textContent = message;
            infoBox.className = 'mt-4 p-4 text-center rounded-lg';
            if (type === 'error') {
                infoBox.classList.add('bg-red-100', 'text-red-800');
            } else {
                infoBox.classList.add('bg-green-100', 'text-green-800');
            }
            infoBox.classList.remove('hidden');
            
            // Auto hide setelah 5 detik untuk success message
            if (type === 'success') {
                setTimeout(() => {
                    infoBox.classList.add('hidden');
                }, 5000);
            }
        }

        // Fungsi untuk ganti Tab
        function showTab(tabId) {
            // Sembunyikan semua tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            // Hapus style aktif dari semua tombol
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Tampilkan tab content yang dipilih
            document.getElementById(tabId).classList.add('active');
            // Tambahkan style aktif ke tombol yang diklik
            document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        // Fungsi-fungsi generate HTML lainnya
        function generateMatriksJawabanHTML(hasil) {
            let html = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Hasil 3: Matriks Jawaban Siswa</h2>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                             alt="Logo SMK Negeri 1 Purbalingga" class="h-8 w-auto">
                        <span>SMK Negeri 1 Purbalingga</span>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200 text-xs">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-2 py-1 text-left font-medium text-gray-600 uppercase">NIS</th>
                                <th class="px-2 py-1 text-left font-medium text-gray-600 uppercase">Nama</th>
            `;
            
            // Header untuk nomor soal
            for (let i = 1; i <= hasil.jumlahSoal; i++) {
                html += `<th class="px-1 py-1 font-medium text-gray-600 uppercase text-center">${i}</th>`;
            }
            
            html += `
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Data siswa
            hasil.analisisSiswa.forEach(siswa => {
                const rowClass = siswa.status === 'Remedial' ? 'bg-red-50' : '';
                html += `
                    <tr class="${rowClass}">
                        <td class="px-2 py-1 text-gray-900">${siswa.nis}</td>
                        <td class="px-2 py-1 text-gray-900">${siswa.nama}</td>
                `;
                
                // Jawaban per soal
                siswa.jawaban.forEach((jawaban, index) => {
                    const kunci = hasil.analisisSoal[index].kunci;
                    const isCorrect = jawaban.toUpperCase() === kunci;
                    const cellClass = isCorrect ? 'text-green-600 font-bold' : 'text-red-600';
                    const symbol = isCorrect ? '‚úì' : (jawaban === '-' ? '' : '‚úó');
                    
                    html += `<td class="px-1 py-1 text-center ${cellClass}">${symbol}</td>`;
                });
                
                html += `</tr>`;
            });
            
            // Baris kunci jawaban
            html += `
                    <tr class="bg-blue-50 font-bold">
                        <td class="px-2 py-1" colspan="2">KUNCI JAWABAN</td>
            `;
            
            hasil.analisisSoal.forEach(soal => {
                html += `<td class="px-1 py-1 text-center text-blue-700">${soal.kunci}</td>`;
            });
            
            html += `
                    </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            return html;
        }

        function generateDaftarSoalHTML(hasil) {
            let html = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Hasil 4: Daftar Soal & Analisis</h2>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                             alt="Logo SMK Negeri 1 Purbalingga" class="h-8 w-auto">
                        <span>SMK Negeri 1 Purbalingga</span>
                    </div>
                </div>
                <div class="space-y-6">
            `;
            
            hasil.analisisSoal.forEach(soal => {
                const kategoriClass = soal.kategori === 'Sulit' ? 'sulit' : 
                                   soal.kategori === 'Sedang' ? 'sedang' : 'mudah';
                const badgeClass = soal.kategori === 'Sulit' ? 'badge-sulit' : 
                                soal.kategori === 'Sedang' ? 'badge-sedang' : 'badge-mudah';
                
                html += `
                    <div class="soal-card ${kategoriClass} p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-lg">Soal Nomor ${soal.no}</h3>
                                <div class="flex items-center space-x-2 mt-1">
                                    <span class="text-sm text-gray-600">Kunci: <strong>${soal.kunci}</strong></span>
                                    <span class="text-sm text-gray-600">|</span>
                                    <span class="text-sm text-gray-600">Tingkat Kesukaran: <strong>${soal.P.toFixed(2)}</strong></span>
                                    <span class="badge ${badgeClass}">${soal.kategori}</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded border border-gray-200">
                            <p class="text-gray-800 whitespace-pre-wrap">${soal.soalText || `Soal nomor ${soal.no} (belum diisi)`}</p>
                        </div>
                        <div class="mt-2 text-sm text-gray-600">
                            <strong>Analisis:</strong> Soal ini dijawab benar oleh ${soal.benar} dari ${hasil.totalSiswa} siswa (${(soal.P * 100).toFixed(1)}%).
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            return html;
        }
    </script>
</body>
</html>
